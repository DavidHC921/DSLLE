{% extends "base.html" %}
{% block title %}Modelo ML ¬∑ DSLLE{% endblock %}
{% block content %}

<section class="card" style="display:grid;gap:16px;grid-template-columns:1.1fr .9fr;">
  <!-- Proceso -->
  <div>
    <h2 style="margin:0 0 8px;">Proceso (Google Colab)</h2>
    <div id="stepTitle" class="kicker" style="margin-bottom:8px;">Paso 1 ‚Ä¢ Importar librer√≠as</div>

    <pre id="typewriter"
         style="white-space:pre-wrap;background:#0b1020;color:#e6f1ff;padding:14px;border-radius:12px;min-height:300px;overflow:auto;box-shadow:var(--shadow);">
    </pre>

    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
      <button id="prevBtn" class="btn btn-ghost" disabled>Anterior</button>
      <button id="nextBtn" class="btn btn-kiwi">Siguiente</button>
      <button id="copyBtn" class="btn btn-ghost">Copiar c√≥digo</button>
      <a class="btn btn-ghost" target="_blank" rel="noopener"
         href="https://colab.research.google.com/">Abrir en Colab</a>
    </div>
  </div>

  <!-- Resultados -->
  <div>
    <h2 style="margin:0 0 8px;">Resultados</h2>
    <div id="resultado" class="card" style="padding:14px;min-height:300px;">
      <em>Avanza con ‚ÄúSiguiente‚Äù para ver las salidas de cada paso.</em>
    </div>
  </div>
</section>

<script>
/* ====== Pasos con tu c√≥digo real ====== */
const steps = [
  {
    title: "Paso 1 ‚Ä¢ Importar librer√≠as",
    code: `# ==========================================
# 1. Importar librerias
# ==========================================
import numpy as np # Operaciones Aritmeticas
import pandas as pd # Tratamiento de datos
import matplotlib.pyplot as plt # Graficos Nativos
import seaborn as sns # Graficos Especializados`,
    out: `<p>‚úÖ Librer√≠as importadas: <code>numpy</code>, <code>pandas</code>, <code>matplotlib</code>, <code>seaborn</code>.</p>`
  },
  {
    title: "Paso 2 ‚Ä¢ Cargar datos",
    code: `# ==========================================
# 2. Cargar datos
# ==========================================

RUTA = "/content/dataset_cuidado_piel_masculina.csv"
df = pd.read_csv(RUTA, encoding="utf-8")

# Vista r√°pida de los datos como dimensiones del dataset y listado de columnas
print("Filas, Columnas:", df.shape)
print("\\nColumnas:")
print(df.columns.tolist())

print("\\nPrimeras 5 filas:")
display(df.head())

print("\\nUltimas 5 filas:")
display(df.tail())`,
    out: `<p>üì¶ Datos cargados desde <code>/content/dataset_cuidado_piel_masculina.csv</code>.<br>
           Muestra: dimensiones, columnas,con head() vemos las primeras 5 filas y con tail() las 5 √∫ltimas.</p>`
  },
  {
    title: "Paso 3 ‚Ä¢ Evaluaci√≥n de calidad de datos",
    code: `# ==========================================
# 3. Evaluaci√≥n de calidad de datos
# ==========================================

print("\\nCaracteristicas del DataFrame")
print(df.info())

print("\\nMedidas de Tendencia Central")
print(df.describe())

print("\\nMedidas de Tendencia Central -- COMPLETO --")
print(df.describe(include="all"))

print("\\nValores nulos por columna")
print(df.isnull().sum())

print("\\nN√∫mero de filas duplicadas:")
print(df.duplicated().sum())`,
    out: `<p>ü©∫ Calidad de los datos: <code>info()</code>, <code>describe()</code>, nulos por columna y duplicados.</p>`
  },
  {
    title: "Paso 4 ‚Ä¢ Limpieza b√°sica",
    code: `# ==========================================
# 4. Limpieza b√°sica
# ==========================================

# Eliminar filas duplicadas
df = df.drop_duplicates()

# Imputar datos numercios con la mediana
for col in ["edad", "estrato_socioeconomico", "tiene_hijos",
            "usa_productos_skincare", "conocimiento_skincare",
            "influencia_pareja", "presion_social_masculinidad"]:
    df[col] = df[col].fillna(df[col].median())

# Imputar datos categoricos con la moda
for col in ["ciudad", "nivel_educativo", "estado_civil", "ocupacion",
            "ingresos_mensuales", "tipo_piel", "exposicion_solar_trabajo",
            "frecuencia_skincare", "productos_que_usa", "disposicion_pagar",
            "canal_informacion", "problemas_piel"]:
    df[col] = df[col].fillna(df[col].mode()[0])

# Pasar todo el texto a min√∫sculas
for col in df.select_dtypes(include=["object"]).columns:
    df[col] = df[col].str.lower()
print("")`,
    out: `<p>üßπ Limpieza: duplicados removidos, imputaci√≥n (mediana/moda) y normalizaci√≥n a min√∫sculas.</p>`
  },
  {
    title: "Paso 5 ‚Ä¢ An√°lisis univariado",
    code: `# ==========================================
# 5. An√°lisis Univariado
# ==========================================
print("<---Graficos de distribucion--->")
print("")

plt.figure(figsize=(5,5))
plt.pie(
    df["se_cuida_piel"].value_counts(),
    labels=["No se cuidan", "S√≠ se cuidan"],
    autopct="%1.1f%%",
    colors=["#ff9999","#66b3ff"],
    startangle=90
)
plt.title("Proporci√≥n de hombres que se cuidan vs no se cuidan")
plt.show()
print("")

plt.figure(figsize=(6,4))
ax = sns.countplot(x="usa_productos_skincare", data=df, palette="pastel")
ax.set_xticklabels(["No usa productos", "S√≠ usa productos"])
ax.set_ylabel("N√∫mero de personas")
ax.set_xlabel("")
ax.set_title("Uso de productos de skincare en hombres")
plt.show()
print("")

plt.figure(figsize=(7,4))
orden_frecuencia = ["nunca", "mensual", "semanal", "diario"]
ax = sns.countplot(x="frecuencia_skincare", data=df, order=orden_frecuencia, palette="muted")
ax.set_ylabel("N√∫mero de personas")
ax.set_xlabel("Frecuencia declarada")
ax.set_title("Frecuencia del cuidado de la piel en hombres")
plt.show()
print("")

plt.figure(figsize=(7,4))
sns.histplot(df["edad"], bins=15, color="skyblue", edgecolor="black")
plt.xlabel("Edad")
plt.ylabel("N√∫mero de personas")
plt.title("Distribuci√≥n de edades en la muestra")
plt.grid(True, linestyle="--", alpha=0.6)
plt.show()
print("")

plt.figure(figsize=(7,4))
ax = sns.countplot(x="estado_civil", data=df, palette="coolwarm")
ax.set_ylabel("N√∫mero de personas")
ax.set_xlabel("Estado civil")
ax.set_title("Distribuci√≥n de los hombres por estado civil")
plt.xticks(rotation=20)
plt.show()
print("")

plt.figure(figsize=(8,4))
ax = sns.countplot(x="ingresos_mensuales", data=df, palette="viridis")
ax.set_ylabel("N√∫mero de personas")
ax.set_xlabel("Ingresos mensuales")
ax.set_title("Distribuci√≥n de hombres seg√∫n ingresos mensuales")
plt.xticks(rotation=30)
plt.show()
print("")`,
    out: `<p>üìä Gr√°ficos: pastel (cuidado), barras (uso de productos, frecuencia, estado civil, ingresos), histograma (edad).</p>`
  },
  {
    title: "Paso 6 ‚Ä¢ An√°lisis bivariado",
    code: `# ==========================================
# 6. An√°lisis Bivariado
# ==========================================

plt.figure(figsize=(7,4))
ax = sns.countplot(x="estado_civil", hue="se_cuida_piel", data=df, palette="Set2")
ax.set_xlabel("Estado civil")
ax.set_ylabel("N√∫mero de personas")
ax.set_title("Estado civil y cuidado de la piel")
ax.legend(title="¬øSe cuida la piel?", labels=["No", "S√≠"])
plt.xticks(rotation=20)
plt.show()
print("")

plt.figure(figsize=(8,4))
ax = sns.countplot(x="ingresos_mensuales", hue="usa_productos_skincare", data=df, palette="coolwarm")
ax.set_xlabel("Ingresos mensuales")
ax.set_ylabel("N√∫mero de personas")
ax.set_title("Ingresos mensuales y uso de productos de skincare")
ax.legend(title="¬øUsa productos?", labels=["No", "S√≠"])
plt.xticks(rotation=30)
plt.show()
print("")

plt.figure(figsize=(7,4))
sns.boxplot(x="se_cuida_piel", y="edad", data=df, palette="pastel")
plt.xticks([0,1], ["No se cuidan", "S√≠ se cuidan"])
plt.ylabel("Edad")
plt.title("Edad y cuidado de la piel")
plt.show()
print("")`,
    out: `<p>üîó Relaciones con 2 variables: estado civil √ó cuidado, ingresos √ó uso de productos, edad √ó cuidado (boxplot).</p>`
  },
  {
    title: "Paso 7 ‚Ä¢ Conclusiones",
    code: `# ==========================================
# 7. Conclusiones
# ==========================================

print("""
‚úÖ Conclusiones del an√°lisis exploratorio:

- Una proporci√≥n importante de hombres NO se cuida la piel (gr√°fico de pastel).
- El estado civil y los ingresos muestran influencia: los casados y con mayores ingresos tienden a usar m√°s productos.
- La edad tambi√©n marca diferencias: los m√°s j√≥venes muestran mayor disposici√≥n a cuidarse.
- Persisten factores culturales (como prejuicios y presi√≥n social) que limitan el cuidado masculino de la piel.
- Estos hallazgos respaldan la necesidad de iniciativas como la 'Red de Bienestar Masculino' y la marca DSLLE,
  enfocadas en romper estigmas y fomentar h√°bitos de autocuidado en hombres.
""")`,
    out: `<ul>
      <li>Proporci√≥n relevante no se cuida.</li>
      <li>Estado civil e ingresos influyen.</li>
      <li>J√≥venes con mayor disposici√≥n.</li>
      <li>Factores culturales limitantes.</li>
      <li>Respaldan iniciativas de la Red y DSLLE.</li>
    </ul>`
  }
];

/* ====== Typewriter ====== */
const twEl  = document.getElementById("typewriter");
const ttlEl = document.getElementById("stepTitle");
const resEl = document.getElementById("resultado");
const next  = document.getElementById("nextBtn");
const prev  = document.getElementById("prevBtn");
const copyB = document.getElementById("copyBtn");

let idx = 0, i = 0, typing = false, timer = null;
const speed = 12; // ms por caracter

function renderStep(k) {
  ttlEl.textContent = steps[k].title;
  resEl.innerHTML = steps[k].out;
  i = 0;
  twEl.textContent = "";
  typing = true;
  clearTimeout(timer);
  typeChunk();
  prev.disabled = k === 0;
  next.textContent = (k === steps.length - 1) ? "Reiniciar" : "Siguiente";
}

function typeChunk() {
  const txt = steps[idx].code;
  if (i <= txt.length && typing) {
    twEl.textContent = txt.slice(0, i++);
    timer = setTimeout(typeChunk, speed);
  }
}

next.addEventListener("click", () => {
  if (idx === steps.length - 1) { idx = 0; } else { idx++; }
  renderStep(idx);
});
prev.addEventListener("click", () => {
  if (idx > 0) idx--;
  renderStep(idx);
});
copyB.addEventListener("click", async () => {
  await navigator.clipboard.writeText(steps[idx].code);
  copyB.textContent = "Copiado ‚úì";
  setTimeout(() => (copyB.textContent = "Copiar c√≥digo"), 1200);
});

renderStep(idx);
</script>

{% endblock %}
